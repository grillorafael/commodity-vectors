!function(){angular.module("commodity-vectors.controllers",[]),angular.module("commodity-vectors.services",["ngResource"]),angular.module("commodity-vectors",["ui.router","ngMaterial","ngMessages","uiGmapgoogle-maps","commodity-vectors.controllers","commodity-vectors.services"]).config(function($stateProvider,$urlRouterProvider,uiGmapGoogleMapApiProvider,$mdThemingProvider){$mdThemingProvider.theme("default").primaryPalette("blue-grey").accentPalette("indigo"),uiGmapGoogleMapApiProvider.configure({key:"AIzaSyDcM2B0lVx6csyd7-1QMyDa5iwqZB2SJKQ",v:"3.17",libraries:"weather,geometry,visualization"}),$urlRouterProvider.otherwise("/vessels"),$stateProvider.state("vessels",{url:"/vessels",templateUrl:"/views/vessels.html",controller:"VesselsCtrl"})})}(),function(){function Vessel($resource){var ENDPOINT="http://commodity-api.rgrillo.com/api";return $resource(ENDPOINT+"/vessels/:id")}angular.module("commodity-vectors.services").factory("Vessel",Vessel)}(),function(){function VesselsCtrl($scope,$mdDialog,$timeout,Vessel){function updateVesselsList(newVessel){var found=!1;$scope.vessels.forEach(function(vessel,idx){vessel._id===newVessel._id&&(found=!0,newVessel.deleted?$scope.vessels.splice(idx,1):$scope.vessels[idx]=newVessel)}),found||$scope.vessels.push(newVessel)}function displayVesselForm(ev,vessel){vessel=angular.copy(vessel),$mdDialog.show({locals:{vessel:vessel,displayVesselForm:displayVesselForm},controller:"VesselFormCtrl",clickOutsideToClose:!0,templateUrl:"/views/vessels.form.html",targetEvent:ev}).then(function(vessel){vessel&&updateVesselsList(vessel)})}$scope.viewModes=[{value:"/views/fragments/_vessels.card.html",label:"View as Cards"},{value:"/views/fragments/_vessels.list.html",label:"View as List"}];var initialViewMode=localStorage.getItem("vessels_view_mode")||$scope.viewModes[0].value;$scope.status={isLoading:!0,viewMode:initialViewMode},$scope.mapOptions={panControl:!1,rotateControl:!1,scaleControl:!1,streetViewControl:!1},$scope.initialZoom=14,$scope.vessels=Vessel.query(function(vessels){$scope.status.isLoading=!1}),$scope.viewVessel=function(ev,vessel){$mdDialog.show({locals:{vessel:vessel,displayVesselForm:displayVesselForm},controller:"VesselViewCtrl",clickOutsideToClose:!0,templateUrl:"/views/vessels.view.html",targetEvent:ev}).then(function(vessel){vessel&&updateVesselsList(vessel)})},$scope.onChangeViewMode=function(){localStorage.setItem("vessels_view_mode",$scope.status.viewMode)},$scope.addVessel=displayVesselForm,$scope.editVessel=displayVesselForm}angular.module("commodity-vectors.controllers").controller("VesselsCtrl",VesselsCtrl)}(),function(){function VesselViewCtrl($scope,$mdDialog,vessel,displayVesselForm){$scope.vessel=vessel,$scope.map={center:{latitude:vessel.last_known_position[1],longitude:vessel.last_known_position[0]},zoom:12},$scope.setPosition=function(){$scope.map.center={latitude:vessel.last_known_position[1],longitude:vessel.last_known_position[0]}},$scope.openEdit=function(e){displayVesselForm(e,$scope.vessel)},$scope.closeDialog=function(){$mdDialog.hide(!1)}}angular.module("commodity-vectors.controllers").controller("VesselViewCtrl",VesselViewCtrl)}(),function(){function VesselFormCtrl($scope,$mdDialog,$timeout,vessel,Vessel,displayVesselForm){vessel||(vessel={last_known_position:[]},vessel=new Vessel(vessel)),$scope.vessel=vessel,$scope.sending=!1,$scope.deleteChain={first:!0},$scope.onPastePosition=function(){$timeout(function(){var content=$scope.vessel.last_known_position[1];if(content&&2==content.split(",").length){content=content.split(",");var latitude=content[0],longitude=content[1];try{$scope.vessel.last_known_position=[longitude,latitude]}catch(e){}}})},$scope.openEdit=function(e){displayVesselForm(e,$scope.vessel)},$scope.addVessel=function(){$scope.vesselForm.$valid&&($scope.sending=!0,$scope.vessel.$save(function(v,response){$mdDialog.hide(v),$scope.sending=!1},function(response){$scope.sending=!1,response.data.errors&&Object.keys(response.data.errors).forEach(function(field){$scope.vesselForm[field].$setDirty(),$scope.vesselForm[field].$setValidity("required",!1)})}))},$scope.deleteVessel=function(ev){$scope.deleteChain.first?(delete $scope.deleteChain.first,$scope.deleteChain.confirm=!0):($scope.vessel.deleted=new Date,Vessel.remove({id:$scope.vessel._id}),$mdDialog.hide($scope.vessel))},$scope.closeDialog=function(){$mdDialog.hide(!1)}}angular.module("commodity-vectors.controllers").controller("VesselFormCtrl",VesselFormCtrl)}();